openapi: 3.0.3
info:
  title: Evolution Hub API
  description: |
    API-Dokumentation für das Evolution Hub Projekt.
    Diese API ermöglicht die Interaktion mit Benutzerkonten, Projekten, Kommentaren und Tools.
  version: 1.0.0
  contact:
    name: Evolution Hub Team
    url: https://hub-evolution.pages.dev
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://hub-evolution.pages.dev/api
    description: Produktionsserver
  - url: http://localhost:3000/api
    description: Lokaler Entwicklungsserver

tags:
  - name: auth
    description: Authentifizierung und Autorisierung
  - name: users
    description: Benutzerverwaltung
  - name: projects
    description: Projektverwaltung
  - name: comments
    description: Kommentare zu Projekten
  - name: tools
    description: Werkzeuge für Projekte

paths:
  /auth/login:
    $ref: './openapi/paths/auth-login.yaml'
  /auth/register:
    $ref: './openapi/paths/auth-register.yaml'
  /auth/logout:
    $ref: './openapi/paths/auth-logout.yaml'
  /auth/forgot-password:
    $ref: './openapi/paths/auth-forgot-password.yaml'
  /auth/reset-password:
    $ref: './openapi/paths/auth-reset-password.yaml'
  /user/account:
    delete:
      tags:
        - users
      summary: Benutzerkonto löschen
      description: |
        Löscht das Benutzerkonto und alle zugehörigen Daten.
        Dies ist ein permanenter Vorgang, der nur mit einer Bestätigung des Benutzers durchgeführt werden kann.
      operationId: deleteUserAccount
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                confirm:
                  type: boolean
                  description: Bestätigung, dass das Konto gelöscht werden soll.
              required:
                - confirm
      responses:
        '204':
          description: Konto erfolgreich gelöscht
        '400':
          description: Ungültige Anfrage (z.B. fehlende Bestätigung)
          content:
            application/json:
              schema:
                $ref: '../../openapi.yaml#/components/schemas/Error'
              example:
                error: true
                message: Bestätigung erforderlich, um das Konto zu löschen.
                status: 400
        '401':
          $ref: '../../openapi.yaml#/components/responses/Unauthorized'
        '429':
          $ref: '../../openapi.yaml#/components/responses/TooManyRequests'
        '500':
          $ref: '../../openapi.yaml#/components/responses/InternalServerError'
      security:
        - cookieAuth: []
        - csrfToken: []
  /projects:
    post:
      tags:
        - projects
      summary: Projekt erstellen
      description: |
        Erstellt ein neues Projekt für den authentifizierten Benutzer.
      operationId: createProject
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../schemas.yaml#/ProjectCreate'
      responses:
        '201':
          description: Projekt erfolgreich erstellt
          content:
            application/json:
              schema:
                type: object
                properties:
                  project:
                    $ref: '../schemas.yaml#/Project'
              example:
                project:
                  id: f47ac10b-58cc-4372-a567-0e02b2c3d479
                  name: Mein Projekt
                  description: Eine Beschreibung meines Projekts
                  user_id: 550e8400-e29b-41d4-a716-446655440000
                  is_public: false
                  created_at: "2023-01-01T00:00:00Z"
                  updated_at: "2023-01-01T00:00:00Z"
                  user:
                    id: 550e8400-e29b-41d4-a716-446655440000
                    name: John Doe
        '400':
          $ref: '../../openapi.yaml#/components/responses/BadRequest'
        '401':
          $ref: '../../openapi.yaml#/components/responses/Unauthorized'
        '429':
          $ref: '../../openapi.yaml#/components/responses/TooManyRequests'
        '500':
          $ref: '../../openapi.yaml#/components/responses/InternalServerError'
      security:
        - cookieAuth: []
        - csrfToken: []
  /tools:
    get:
      tags:
        - tools
      summary: Tools abrufen
      description: |
        Gibt eine Liste von verfügbaren Tools zurück.
      operationId: getTools
      parameters:
        - name: page
          in: query
          description: Seitennummer für die Paginierung
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          description: Anzahl der Elemente pro Seite
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
      responses:
        '200':
          description: Erfolgreicher Abruf der Tools
          content:
            application/json:
              schema:
                type: object
                properties:
                  tools:
                    type: array
                    items:
                      $ref: '../schemas.yaml#/Tool'
                  pagination:
                    $ref: '../schemas.yaml#/Pagination'
              example:
                tools:
                  - id: 123e4567-e89b-12d3-a456-426614174000
                    name: Code-Editor
                    description: Ein Tool zum Bearbeiten von Code
                    icon: code-editor-icon
                    created_at: "2023-01-01T00:00:00Z"
                    updated_at: "2023-01-01T00:00:00Z"
                pagination:
                  page: 1
                  limit: 10
                  total: 1
        '429':
          $ref: '../../openapi.yaml#/components/responses/TooManyRequests'
        '500':
          $ref: '../../openapi.yaml#/components/responses/InternalServerError'
      security:
        - cookieAuth: []
        - {}  # Auch ohne Authentifizierung zugänglich

components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: auth-token
    csrfToken:
      type: apiKey
      in: header
      name: X-CSRF-Token

  schemas:
    $ref: './openapi/schemas.yaml'

  responses:
    Unauthorized:
      description: Nicht authentifiziert
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: true
            message: Nicht authentifiziert
            status: 401
    
    Forbidden:
      description: Nicht autorisiert
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: true
            message: Nicht autorisiert
            status: 403
    
    NotFound:
      description: Ressource nicht gefunden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: true
            message: Ressource nicht gefunden
            status: 404
    
    BadRequest:
      description: Ungültige Anfrage
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: true
            message: Ungültige Anfrage
            status: 400
    
    TooManyRequests:
      description: Zu viele Anfragen
      headers:
        Retry-After:
          schema:
            type: integer
          description: Sekunden bis zum nächsten erlaubten Versuch
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: true
            message: Zu viele Anfragen. Bitte versuchen Sie es später erneut.
            status: 429
    
    InternalServerError:
      description: Interner Serverfehler
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: true
            message: Interner Serverfehler
            status: 500

security:
  - cookieAuth: []
