---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Card from '../../components/ui/Card.astro';

const locals = Astro.locals as any;
if (!locals.user) {
  return Astro.redirect('/login');
}
const user = locals.user;
---

<BaseLayout title="Account Settings">
  <div class="container mx-auto p-4 sm:p-6 lg:p-8">
    <h1 class="text-3xl font-bold mb-6 text-slate-800 dark:text-white">Account Settings</h1>
    
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      
      <!-- Left Navigation -->
      <div class="lg:col-span-1">
        <nav class="space-y-1">
          <a href="#profile" class="block px-4 py-2 text-sm font-medium rounded-lg bg-sky-100 dark:bg-sky-900/50 text-primary">
            Profile
          </a>
          <a href="#password" class="block px-4 py-2 text-sm font-medium rounded-lg hover:bg-sky-100/50 dark:hover:bg-sky-900/20">
            Password
          </a>
        </nav>
      </div>

      <!-- Right Content -->
      <div class="lg:col-span-2 space-y-8">
        <Card title="Public Profile" id="profile">
          <form id="profile-form">
            <!-- Profile Picture -->
            <div class="flex items-center space-x-4 mb-6">
              <img id="avatar-preview" src={user.image || '/assets/svg/logo.svg'} alt="Avatar" class="w-20 h-20 rounded-full">
              <input type="file" id="avatar-upload" name="avatar" class="hidden" accept="image/*">
              <button type="button" onclick="document.getElementById('avatar-upload').click()" class="px-4 py-2 text-sm font-medium border rounded-lg">
                Change Picture
              </button>
            </div>

            <!-- Name -->
            <div class="mb-4">
              <label for="name" class="block text-sm font-medium mb-1">Name</label>
              <input type="text" id="name" name="name" value={user.name} class="w-full p-2 border rounded-lg dark:bg-slate-700 dark:border-slate-600">
            </div>

            <!-- Username -->
            <div class="mb-4">
              <label for="username" class="block text-sm font-medium mb-1">Username</label>
              <input type="text" id="username" name="username" value={user.username} class="w-full p-2 border rounded-lg dark:bg-slate-700 dark:border-slate-600">
            </div>

            <!-- Email (read-only) -->
            <div class="mb-4">
              <label for="email" class="block text-sm font-medium mb-1">Email</label>
              <input type="email" id="email" name="email" value={user.email} class="w-full p-2 border rounded-lg bg-slate-100 dark:bg-slate-800" readonly>
            </div>

            <button type="submit" class="px-6 py-2 text-white bg-primary rounded-lg hover:bg-primary-dark">
              Save Changes
            </button>
          </form>
        </Card>

        <Card title="Change Password" id="password">
          <form id="password-form">
            <!-- Current Password -->
            <div class="mb-4">
              <label for="current-password" class="block text-sm font-medium mb-1">Current Password</label>
              <input type="password" id="current-password" name="current-password" class="w-full p-2 border rounded-lg dark:bg-slate-700 dark:border-slate-600">
            </div>

            <!-- New Password -->
            <div class="mb-4">
              <label for="new-password" class="block text-sm font-medium mb-1">New Password</label>
              <input type="password" id="new-password" name="new-password" class="w-full p-2 border rounded-lg dark:bg-slate-700 dark:border-slate-600" required>
            </div>

            <!-- Confirm New Password -->
            <div class="mb-4">
              <label for="confirm-password" class="block text-sm font-medium mb-1">Confirm New Password</label>
              <input type="password" id="confirm-password" name="confirm-password" class="w-full p-2 border rounded-lg dark:bg-slate-700 dark:border-slate-600" required>
            </div>

            <!-- Password Strength Indicator -->
            <div id="password-strength" class="mb-4 text-sm"></div>

            <!-- Validation Messages -->
            <div id="password-errors" class="mb-4 text-sm text-red-500"></div>

            <button type="submit" class="px-6 py-2 text-white bg-primary rounded-lg hover:bg-primary-dark">
              Update Password
            </button>
          </form>
        </Card>
      </div>
    </div>
  </div>
</BaseLayout>

<script is:inline src="/scripts/settings.ts"></script>