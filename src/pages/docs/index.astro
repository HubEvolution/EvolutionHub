---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getLocale } from '@/lib/i18n';
import { getI18n, getI18nArray } from '@/utils/i18n';
import { localizePath } from '@/lib/locale-path';
import DocsBackground from '@/components/docs/DocsBackground.astro';
import DocsHero from '@/components/docs/DocsHero.astro';
import DocsSteps from '@/components/docs/DocsSteps.astro';
import DocsResources from '@/components/docs/DocsResources.astro';
import type { DirectAccessItem, DocsResource, DocsStep } from '@/components/docs/types';

const locale = getLocale(Astro.url.pathname);
const t = getI18n(locale);
const tList = getI18nArray(locale);

const stepLinkMap = {
  step1: '/register',
  step2: '/dashboard',
  step3: '/tools',
  step4: '/blog',
} as const;

const stepKeys = ['step1', 'step2', 'step3', 'step4'] as const;

const steps: DocsStep[] = stepKeys.map((key) => ({
  title: t(`pages.docs.steps.${key}.title`),
  description: t(`pages.docs.steps.${key}.description`),
  link: localizePath(locale, stepLinkMap[key]),
  linkLabel: t(`pages.docs.steps.${key}.linkLabel`),
  checklist: tList(`pages.docs.steps.${key}.checklist`),
}));

const resources: DocsResource[] = [
  {
    title: t('pages.docs.resources.tools.title'),
    description: t('pages.docs.resources.tools.description'),
    link: localizePath(locale, '/tools'),
    icon: 'sparkles',
  },
  {
    title: t('pages.docs.resources.faq.title'),
    description: t('pages.docs.resources.faq.description'),
    link: localizePath(locale, '/faq'),
    icon: 'question-mark-circle',
  },
  {
    title: t('pages.docs.resources.pricing.title'),
    description: t('pages.docs.resources.pricing.description'),
    link: localizePath(locale, '/pricing'),
    icon: 'chart-square-bar',
  },
  {
    title: t('pages.docs.resources.contact.title'),
    description: t('pages.docs.resources.contact.description'),
    link: localizePath(locale, '/kontakt'),
    icon: 'chat',
  },
  {
    title: t('pages.docs.resources.blog.title'),
    description: t('pages.docs.resources.blog.description'),
    link: localizePath(locale, '/blog'),
    icon: 'book-open',
  },
];

const directAccess: DirectAccessItem[] = [
  { label: t('pages.docs.resources.tools.title'), href: localizePath(locale, '/tools') },
  { label: t('pages.docs.resources.faq.title'), href: localizePath(locale, '/faq') },
  { label: t('pages.docs.resources.pricing.title'), href: localizePath(locale, '/pricing') },
  { label: t('pages.docs.resources.blog.title'), href: localizePath(locale, '/blog') },
];
---

<BaseLayout
  title={t('pages.docs.meta.title')}
  description={t('pages.docs.meta.description')}
  hideDebugPanel={true}
>
  <div
    class="landing-v2 docs-landing relative overflow-hidden bg-[rgb(var(--docs-bg))] text-[rgb(var(--docs-fg))] selection:bg-[rgba(var(--docs-accent)/0.22)] selection:text-[rgb(var(--docs-fg))]"
  >
    <DocsBackground />
    <section class="pt-24 sm:pt-28 pb-16 sm:pb-20">
      <div class="mx-auto w-full max-w-7xl px-4 space-y-10 sm:space-y-12 relative z-10">
        <DocsHero
          kicker={t('pages.docs.hero.kicker')}
          title={t('pages.docs.hero.title')}
          subtitle={t('pages.docs.hero.subtitle')}
          primaryCta={{ label: steps[0].linkLabel, href: steps[0].link }}
          secondaryCta={{ label: resources[0].title, href: resources[0].link }}
          directAccess={directAccess}
          searchLabel={t('pages.docs.search.label')}
          searchPlaceholder={t('pages.docs.search.placeholder')}
          accessLabel={t('pages.docs.access.title')}
          footerNote={t('pages.docs.search.note')}
        />

        <div class="grid gap-8 lg:gap-10 lg:grid-cols-[1.15fr,0.85fr] lg:items-start">
          <DocsSteps
            title={t('pages.docs.steps.title')}
            subtitle={t('pages.docs.steps.subtitle')}
            steps={steps}
          />

          <DocsResources
            title={t('pages.docs.resources.title')}
            subtitle={t('pages.docs.resources.subtitle')}
            actionLabel={t('pages.docs.resources.action')}
            resources={resources}
          />
        </div>
      </div>
    </section>
  </div>
</BaseLayout>
