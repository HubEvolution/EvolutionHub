---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getI18n } from '@/utils/i18n';
import { isToolVisible } from '@/lib/tools-availability';
import ToolHero from '@/components/landing/ToolHero.astro';
import ProofBlock from '@/components/landing/ProofBlock.astro';
import QuickFlow from '@/components/landing/QuickFlow.astro';
import UseCases from '@/components/landing/UseCases.astro';
import PromptStarters from '@/components/landing/PromptStarters.astro';

import { getLocale } from '@/lib/i18n';
import { localizePath } from '@/lib/locale-path';

const locale = getLocale(Astro.url.pathname);
const t = getI18n(locale);

const runtimeEnv = (Astro.locals && Astro.locals.runtime && Astro.locals.runtime.env) || undefined;

function flagOn(raw: string | undefined | null): boolean {
  if (raw === undefined || raw === null) return true;
  const v = String(raw).toLowerCase().trim();
  return !(v === '0' || v === 'false' || v === 'off' || v === 'no');
}

const env = (runtimeEnv as unknown as Record<string, string | undefined>) || undefined;

function isToolEnabled(toolId: string): boolean {
  if (!env) return isToolVisible(toolId);

  switch (toolId) {
    case 'prompt-enhancer':
      return flagOn(env.PUBLIC_PROMPT_ENHANCER_V1);
    case 'Imag-Enhancer': {
      const mvpOn = flagOn(env.PUBLIC_ENHANCER_MVP_MODE);
      const legacyOn = flagOn(env.PUBLIC_ENHANCER_LEGACY_MODE);
      return mvpOn || legacyOn;
    }
    case 'video-enhancer':
      return flagOn(env.ENABLE_VIDEO_ENHANCER);
    case 'voice-visualizer':
      return flagOn(env.PUBLIC_TOOL_VOICE_VISUALIZER);
    case 'webscraper':
      return flagOn(env.PUBLIC_TOOL_WEBSCRAPER) && flagOn(env.PUBLIC_WEBSCRAPER_V1);
    case 'web-eval':
      return flagOn(env.PUBLIC_TOOL_WEB_EVAL);
    default:
      return true;
  }
}

const showImagEnhancer = isToolEnabled('Imag-Enhancer');
const showVoiceVisualizer = isToolEnabled('voice-visualizer');
const showWebscraper = isToolEnabled('webscraper');
const showVideoEnhancer = isToolEnabled('video-enhancer');
const showWebEval = isToolEnabled('web-eval');

const hasSecondaryTools =
  showImagEnhancer || showVoiceVisualizer || showWebscraper || showVideoEnhancer || showWebEval;

export const prerender = false;
---

<BaseLayout
  title="AI development tools: web scraper, transcription & image upscaler"
  description="Build faster with AI-powered tools for data extraction, transcription, image upscaling & video enhancement. Free trial, no credit card needed."
  disableGlobalBg={true}
  enableAOS={false}
>
  <style is:global>
    @import '@/styles/landing-home.css';
  </style>
  <div class="landing-home relative bg-[rgb(var(--lp-page-bg))] text-[rgb(var(--lp-page-fg))]">
    <ToolHero t={t} ctaHref={localizePath(locale, '/tools/prompt-enhancer/app')} />

    <div class="lp-section-bg">
      <ProofBlock t={t} />

      <QuickFlow t={t} ctaHref={localizePath(locale, '/tools/prompt-enhancer/app')} />

      <UseCases t={t} />
      <PromptStarters t={t} />

      <!-- Secondary tools (de-emphasized) -->
      {
        hasSecondaryTools && (
          <section class="container mx-auto px-4 pb-16">
            <div class="mx-auto max-w-5xl border-t border-[rgba(var(--lp-page-border)/0.65)] pt-8">
              <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                <div class="text-sm text-[rgb(var(--lp-page-muted))]">
                  {t('pages.home.other_tools.label')}
                </div>
                <div class="flex flex-wrap gap-x-5 gap-y-2 text-sm">
                  {showImagEnhancer && (
                    <a
                      href={localizePath(locale, '/tools/imag-enhancer/app')}
                      class="underline underline-offset-4 decoration-[rgba(var(--lp-page-border)/0.8)] hover:decoration-[rgba(var(--lp-accent)/0.8)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[rgb(var(--lp-accent))] focus-visible:ring-offset-2 focus-visible:ring-offset-[rgb(var(--lp-page-bg))] rounded-sm transition-colors duration-200"
                    >
                      {t('pages.home.features.feature1.title')}
                    </a>
                  )}
                  {showVoiceVisualizer && (
                    <a
                      href={localizePath(locale, '/tools/voice-visualizer/app')}
                      class="underline underline-offset-4 decoration-[rgba(var(--lp-page-border)/0.8)] hover:decoration-[rgba(var(--lp-accent)/0.8)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[rgb(var(--lp-accent))] focus-visible:ring-offset-2 focus-visible:ring-offset-[rgb(var(--lp-page-bg))] rounded-sm transition-colors duration-200"
                    >
                      {t('pages.home.features.feature3.title')}
                    </a>
                  )}
                  {showWebscraper && (
                    <a
                      href={localizePath(locale, '/tools/webscraper/app')}
                      class="underline underline-offset-4 decoration-[rgba(var(--lp-page-border)/0.8)] hover:decoration-[rgba(var(--lp-accent)/0.8)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[rgb(var(--lp-accent))] focus-visible:ring-offset-2 focus-visible:ring-offset-[rgb(var(--lp-page-bg))] rounded-sm transition-colors duration-200"
                    >
                      {t('pages.home.features.feature4.title')}
                    </a>
                  )}
                  {showVideoEnhancer && (
                    <a
                      href={localizePath(locale, '/tools/video-enhancer/app')}
                      class="underline underline-offset-4 decoration-[rgba(var(--lp-page-border)/0.8)] hover:decoration-[rgba(var(--lp-accent)/0.8)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[rgb(var(--lp-accent))] focus-visible:ring-offset-2 focus-visible:ring-offset-[rgb(var(--lp-page-bg))] rounded-sm transition-colors duration-200"
                    >
                      {t('pages.home.features.feature5.title')}
                    </a>
                  )}
                  {showWebEval && (
                    <a
                      href={localizePath(locale, '/tools/web-eval/app')}
                      class="underline underline-offset-4 decoration-[rgba(var(--lp-page-border)/0.8)] hover:decoration-[rgba(var(--lp-accent)/0.8)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[rgb(var(--lp-accent))] focus-visible:ring-offset-2 focus-visible:ring-offset-[rgb(var(--lp-page-bg))] rounded-sm transition-colors duration-200"
                    >
                      {t('pages.home.features.feature6.title')}
                    </a>
                  )}
                  <a
                    href={localizePath(locale, '/tools')}
                    class="underline underline-offset-4 decoration-[rgba(var(--lp-page-border)/0.8)] hover:decoration-[rgba(var(--lp-accent)/0.8)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[rgb(var(--lp-accent))] focus-visible:ring-offset-2 focus-visible:ring-offset-[rgb(var(--lp-page-bg))] rounded-sm transition-colors duration-200"
                  >
                    {t('pages.home.other_tools.all_tools')}
                  </a>
                </div>
              </div>
            </div>
          </section>
        )
      }

      <!-- Bottom close (finish the page, same primary CTA) -->
      <section class="container mx-auto px-4 pb-16 md:pb-20">
        <div class="mx-auto max-w-5xl border-t border-[rgba(var(--lp-page-border)/0.65)] pt-10">
          <div class="mx-auto max-w-3xl text-center">
            <h2 class="text-xl sm:text-2xl font-semibold text-[rgb(var(--lp-page-fg))]">
              {t('pages.home.bottom_cta.headline')}
            </h2>
            <div class="mt-6 flex justify-center">
              <a
                href={localizePath(locale, '/tools/prompt-enhancer/app')}
                class="inline-flex items-center justify-center rounded-full px-7 py-3.5 text-sm sm:text-base font-semibold bg-[rgb(var(--lp-accent))] text-[rgb(var(--lp-accent-ink))] hover:bg-[rgb(var(--lp-accent-hover))] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[rgb(var(--lp-accent))] focus-visible:ring-offset-2 focus-visible:ring-offset-[rgb(var(--lp-page-bg))] transition-colors duration-200"
              >
                {t('pages.home.hero.cta_primary')}
              </a>
            </div>
            <p class="mt-4 text-sm text-[rgb(var(--lp-page-muted))]">
              {t('pages.home.bottom_cta.subline')}
            </p>
          </div>
        </div>
      </section>

      <div class="h-14 md:h-20 lp-section-bottom-fade" aria-hidden="true"></div>
    </div>
  </div>
</BaseLayout>
