---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getI18n, getI18nArray } from '@/utils/i18n';
import TypewriterComponent from '@/components/scripts/TypewriterComponent.astro';
import TestimonialsRotatingGrid from '@/components/landing/TestimonialsRotatingGrid';
import { getTestimonials } from '@/lib/content/testimonials';
import AosWrapper from '@/components/AosWrapper.astro';
import { isLandingV2Enabled } from '@/utils/feature-flags';
import HoloFeaturePanel from '@/components/landing/HoloFeaturePanel.astro';
import CardGraph from '@/components/landing/CardGraph';
import StarfieldBackdrop from '@/components/landing/StarfieldBackdrop';
import ConnectionCTA from '@/components/landing/ConnectionCTA.astro';
import HeroStatusLights from '@/components/landing/HeroStatusLights';

import EvolutionHubLogo from '@/components/brand/EvolutionHubWordmarkOutlined.astro';

import { getLocale } from '@/lib/i18n';
import { localizePath } from '@/lib/locale-path';
const locale = getLocale(Astro.url.pathname);
const t = getI18n(locale);
const tArr = getI18nArray(locale);
const heroTypewriterTexts = tArr('pages.home.hero.typewriter_lines');
const heroTypewriterAll = [t('pages.home.hero.title_part2'), ...heroTypewriterTexts];
const heroTypewriterItems = heroTypewriterAll.map((text) => ({ text, delay: 1100 }));
const landingV2 = isLandingV2Enabled();
const heroSubtitle = landingV2
  ? t('pages.home.hero.subtitle_poetic') ?? t('pages.home.hero.subtitle')
  : t('pages.home.hero.subtitle');
const testimonials = await getTestimonials({ tools: ['imag', 'prompt', 'voice'], lang: 'en', limit: 6 });
export const prerender = false;
---

<BaseLayout title={t('pages.home.title') ?? 'Evolution Hub'}>
  <div class="landing-v2 relative">
  <!-- Hero Section -->
  <section class="relative py-6 md:py-12 bg-transparent overflow-hidden">
    <div class="mx-auto px-4 relative z-10">
      <div class="max-w-[110rem] mx-auto text-center">
        <AosWrapper
          tag="h1"
          class="mb-4 text-gray-900 dark:text-white leading-tight"
        >
          <span class="block leading-none">
            <EvolutionHubLogo
              class="relative z-20 block mx-auto py-3 md:py-4 w-full max-w-[22rem] sm:max-w-[26rem] h-auto md:w-auto md:max-w-none md:h-32 lg:h-36 xl:h-40 2xl:h-44 logo-glow pointer-events-none"
              aria-label="Evolution Hub logo"
              data-brand="wordmark-outlined"
            />
            <span class="sr-only">{t('pages.home.hero.title_part1')}</span>
          </span>
        </AosWrapper>
        <AosWrapper
          tag="p"
          delay={100}
          duration={650}
          class="text-2xl md:text-4xl text-cyan-300 subtitle-glow mb-6 max-w-5xl mx-auto"
        >
          <span
            id="hero-typewriter-sub"
            aria-live="polite"
            class="block min-h-[1.2em] whitespace-nowrap text-accent-gradient [text-shadow:_0_1px_0_rgb(255_255_255_/_0.6)] dark:[text-shadow:_0_1px_0_rgb(0_0_0_/_0.35)]"
            >{heroSubtitle}</span
          >
        </AosWrapper>

        <TypewriterComponent
          elementId="hero-typewriter-sub"
          texts={heroTypewriterItems}
          defaultDelay={120}
          smallScreenDelay={55}
          smallScreenMaxWidth={768}
          loop={true}
        />
        <AosWrapper
          delay={200}
          duration={650}
          class="flex flex-col sm:flex-row justify-center gap-3 sm:gap-4"
        >
          <HeroStatusLights
            client:load
            labels={{
              infra: t('pages.home.hero.status_labels.infra'),
              image: t('pages.home.features.feature1.title'),
              prompt: t('pages.home.features.feature2.title'),
              voice: t('pages.home.features.feature3.title'),
              web: t('pages.home.features.feature4.title'),
            }}
            icons={{
              infra: 'server',
              image: t('pages.home.features.feature1.icon'),
              prompt: t('pages.home.features.feature2.icon'),
              voice: t('pages.home.features.feature3.icon'),
              web: t('pages.home.features.feature4.icon'),
            }}
            iconsOnly={true}
          />
        </AosWrapper>
      </div>
    </div>
    <!-- No page-level fallback background; global background handles visuals -->
    <!-- Overlay fade: ~10% black at top -> 0% at ~55% height -->
    <div
      class="absolute inset-0 pointer-events-none z-0 landing-hero-overlay"
      aria-hidden="true"
    />
  </section>

  <!-- Features Section -->
  <section class="py-8 md:py-12 bg-transparent">
    <div class="container mx-auto px-4">
      <div class="text-center mb-12">
        <AosWrapper
          tag="h2"
          duration={650}
          class="text-4xl font-bold text-gray-900 dark:text-white mb-4"
        >
          {t('pages.home.features.heading')}
        </AosWrapper>
        <AosWrapper
          tag="p"
          delay={100}
          duration={650}
          class="text-lg text-gray-600 dark:text-gray-300 max-w-3xl mx-auto"
        >
          {t('pages.home.features.subtitle')}
        </AosWrapper>
      </div>
      <div class="relative">
        <CardGraph client:load className="z-0" fullBleed={true} />
        <div class="grid grid-cols-1 md:grid-cols-4 gap-12 relative z-10">
        <AosWrapper duration={600} class="feature-card">
          <HoloFeaturePanel
            iconName={t('pages.home.features.feature1.icon')}
            title={t('pages.home.features.feature1.title')}
            description={landingV2
              ? (t('pages.home.features_poetic.feature1.description') ?? t('pages.home.features.feature1.description'))
              : t('pages.home.features.feature1.description')}
          />
        </AosWrapper>
        <AosWrapper delay={100} duration={600} class="feature-card">
          <HoloFeaturePanel
            iconName={t('pages.home.features.feature2.icon')}
            title={t('pages.home.features.feature2.title')}
            description={landingV2
              ? (t('pages.home.features_poetic.feature2.description') ?? t('pages.home.features.feature2.description'))
              : t('pages.home.features.feature2.description')}
          />
        </AosWrapper>
        <AosWrapper delay={200} duration={600} class="feature-card">
          <HoloFeaturePanel
            iconName={t('pages.home.features.feature3.icon')}
            title={t('pages.home.features.feature3.title')}
            description={landingV2
              ? (t('pages.home.features_poetic.feature3.description') ?? t('pages.home.features.feature3.description'))
              : t('pages.home.features.feature3.description')}
          />
        </AosWrapper>
        <AosWrapper delay={300} duration={600} class="feature-card">
          <HoloFeaturePanel
            iconName={t('pages.home.features.feature4.icon')}
            title={t('pages.home.features.feature4.title')}
            description={landingV2
              ? (t('pages.home.features_poetic.feature4.description') ?? t('pages.home.features.feature4.description'))
              : t('pages.home.features.feature4.description')}
          />
        </AosWrapper>
        </div>
      </div>
    </div>
  </section>

  <!-- Testimonials Section -->
  <section
    class="relative overflow-hidden py-8 md:py-12 bg-transparent"
  >
    <div class="container mx-auto px-4">
      <StarfieldBackdrop client:load className="z-0" density={360} fullBleed={true} />
      <div class="text-center mb-16">
        <div class="mb-3 text-sm font-medium text-emerald-300/90 tracking-wide">{t('pages.home.testimonials.trust_line') ?? 'Used by 1,200+ creators'}</div>
        <AosWrapper
          tag="h2"
          duration={650}
          class="text-4xl font-bold text-gray-900 dark:text-white mb-4"
        >
          {t('pages.home.testimonials.heading')}
        </AosWrapper>
        <AosWrapper
          tag="p"
          delay={100}
          duration={650}
          class="text-lg text-gray-600 dark:text-gray-300 max-w-2xl mx-auto"
        >
          {t('pages.home.testimonials.subtitle')}
        </AosWrapper>
      </div>
      <TestimonialsRotatingGrid client:load items={testimonials} intervalMs={6500} />
    </div>
  </section>

  <!-- Call to Action Section -->
  <section class="py-8 md:py-12">
    <div class="container mx-auto px-4">
      <ConnectionCTA
        title={t('cta.headline')}
        subtitle={t('cta.subtitle')}
        buttonText={t('cta.button_text')}
        buttonHref={localizePath(locale, '/register')}
      />
    </div>
  </section>
  </div>
</BaseLayout>

<style>
  .logo-glow { filter: drop-shadow(0 0 10px rgba(6, 182, 212, 0.22)) drop-shadow(0 0 18px rgba(148, 163, 184, 0.16)); }
  .subtitle-glow { text-shadow: 0 0 6px rgba(6, 182, 212, 0.28), 0 0 16px rgba(148, 163, 184, 0.18); }
</style>
