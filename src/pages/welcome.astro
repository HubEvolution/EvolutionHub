---
import { getI18n } from '@/utils/i18n';
import { getLocale } from '@/lib/i18n';

const locale = getLocale(Astro.url.pathname);
const t = getI18n(locale);

const nextRaw = Astro.url.searchParams.get('next') ?? '/';

// Build a safe canonical URL (same-origin only)
let canonicalHref: string | null = null;
try {
  const nextUrl = new URL(nextRaw, Astro.url.origin);
  if (nextUrl.origin === Astro.url.origin) {
    canonicalHref = nextUrl.toString();
  }
} catch {
  canonicalHref = null;
}

const hrefDe = `/welcome?set_locale=de&next=${encodeURIComponent(nextRaw)}`;
const hrefEn = `/welcome?set_locale=en&next=${encodeURIComponent(nextRaw)}`;
---
<!DOCTYPE html>
<html lang={locale} class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{t('pages.welcome.title') || 'Welcome'}</title>
    <meta name="robots" content="noindex, nofollow, noarchive" />
    {canonicalHref && <link rel="canonical" href={canonicalHref} />}
    <style>
      @keyframes float {
        0% { transform: translateY(0); }
        50% { transform: translateY(-8px); }
        100% { transform: translateY(0); }
      }
    </style>
  </head>
  <body class="min-h-screen bg-sky-50 dark:bg-slate-900 text-slate-800 dark:text-slate-200 flex items-center justify-center p-6">
    <main class="w-full max-w-2xl text-center">
      <div class="mx-auto mb-8 w-20 h-20 rounded-full bg-white/80 dark:bg-slate-800/70 shadow flex items-center justify-center" style="animation: float 3s ease-in-out infinite;">
        <img src="/favicon.svg" alt="Evolution Hub" class="w-10 h-10" />
      </div>
      <h1 class="text-3xl md:text-4xl font-extrabold mb-3">
        {t('pages.welcome.title') || 'Welcome'}
      </h1>
      <p class="text-base md:text-lg text-slate-600 dark:text-slate-300 mb-8">
        {t('pages.welcome.subtitle') || 'Please choose your language'}
      </p>

      <div class="flex items-center justify-center gap-4">
        <a href={hrefDe} class="inline-flex items-center gap-2 px-6 py-3 rounded-xl font-semibold text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:ring-offset-2 focus:ring-offset-sky-50 dark:focus:ring-offset-slate-900">
          ðŸ‡©ðŸ‡ª {t('pages.welcome.buttons.de') || 'Deutsch'}
        </a>
        <a href={hrefEn} class="inline-flex items-center gap-2 px-6 py-3 rounded-xl font-semibold text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-offset-2 focus:ring-offset-sky-50 dark:focus:ring-offset-slate-900">
          ðŸ‡¬ðŸ‡§ {t('pages.welcome.buttons.en') || 'English'}
        </a>
      </div>

      <p class="mt-6 text-xs text-slate-500 dark:text-slate-400">
        {locale === 'de' ? 'Ihre Auswahl wird gespeichert.' : 'Your selection will be saved.'}
      </p>
    </main>
  </body>
</html>
