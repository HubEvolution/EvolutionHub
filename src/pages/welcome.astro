---
import BaseLayout from '@/layouts/BaseLayout.astro';

const nextRaw = Astro.url.searchParams.get('next') ?? '/';

// Build a safe canonical URL (same-origin only)
let canonicalHref: string | null = null;
try {
  const nextUrl = new URL(nextRaw, Astro.url.origin);
  if (nextUrl.origin === Astro.url.origin) {
    canonicalHref = nextUrl.toString();
  }
} catch {
  canonicalHref = null;
}

const hrefDe = `/welcome?set_locale=de&next=${encodeURIComponent(nextRaw)}`;
const hrefEn = `/welcome?set_locale=en&next=${encodeURIComponent(nextRaw)}`;
---
<BaseLayout
  title="Welcome / Willkommen"
  description="Please choose your language / Bitte wähle deine Sprache"
  canonical={canonicalHref ?? undefined}
  hideNewsletter={true}
  hideHeader={true}
  hideFooter={true}
>
  <section class="container min-h-screen flex flex-col items-center justify-center text-center">
    <div class="mx-auto mb-8 w-20 h-20 rounded-full glass flex items-center justify-center animate-bounce motion-reduce:animate-none">
      <img src="/favicons/favicon-32x32.png" alt="Evolution Hub" class="w-10 h-10" />
    </div>
    <h1>Welcome / Willkommen</h1>
    <p class="mt-3 text-gray-600 dark:text-gray-300">Please choose your language / Bitte wähle deine Sprache</p>

    <div class="mt-8 flex items-center justify-center gap-4">
      <a href={hrefDe} class="btn btn-primary">Deutsch</a>
      <a href={hrefEn} class="btn btn-secondary">English</a>
    </div>

    <p class="mt-6 text-xs text-gray-500 dark:text-gray-400">Your selection will be saved. / Ihre Auswahl wird gespeichert.</p>
  </section>
</BaseLayout>
