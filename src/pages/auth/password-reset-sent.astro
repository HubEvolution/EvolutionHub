---
import AuthLayout from '@/layouts/AuthLayout.astro';
---

<AuthLayout title="Password Reset Sent">
  <div class="text-center">
    <h1 class="text-2xl font-bold mb-4">Link zum Zur端cksetzen des Passworts gesendet</h1>
    <p class="text-gray-600 dark:text-gray-400">
      Wenn ein Benutzer mit dieser E-Mail-Adresse existiert, wurde ein Link zum Zur端cksetzen des Passworts gesendet. Bitte 端berpr端fen Sie Ihren Posteingang.
    </p>
  </div>
</AuthLayout>

<script type="module">
  (async () => {
    try {
      const { default: notify } = await import('@/lib/notify');
      const url = new URL(window.location.href);
      const params = url.searchParams;

      const isGerman = window.location.pathname.startsWith('/de');
      const success = params.get('success');
      const error = params.get('error');

      if (success) {
        notify.success(isGerman ? 'E-Mail wurde versendet.' : 'Email has been sent.');
      }
      if (error) {
        const code = error;
        notify.error(isGerman ? `Versand fehlgeschlagen (${code}).` : `Sending failed (${code}).`);
      }

      // Cleanup known params
      let mutated = false;
      ['success', 'error'].forEach((key) => {
        if (params.has(key)) {
          params.delete(key);
          mutated = true;
        }
      });
      if (mutated) {
        const newQuery = params.toString();
        const newUrl = url.pathname + (newQuery ? `?${newQuery}` : '') + url.hash;
        window.history.replaceState({}, document.title, newUrl);
      }
    } catch (e) {
      console.error('[PasswordResetSent] URL status handling failed:', e);
    }
  })();
</script>