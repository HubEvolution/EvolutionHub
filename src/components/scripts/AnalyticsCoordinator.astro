---
// AnalyticsCoordinator.astro - Build-kompatible Initialisierung der Analytics-Runtime
// Kapselt das Laden der Runtime und sorgt fÃ¼r saubere Lifecycle-Integration
---

<script is:inline nonce={Astro.locals.cspNonce}>
  // Minimaler, robust gebundelter Loader Ã¼ber Astro.resolve
  function initializeAnalyticsCoordinator() {
    import(Astro.resolve('@/scripts/analytics-runtime.ts'))
      .then((mod) => {
        const init = mod && (mod.default || mod);
        if (typeof init === 'function') {
          init();
          console.log('[AnalyticsCoordinator] âœ… Runtime initialized');
        } else {
          console.warn('[AnalyticsCoordinator] âš ï¸ No default init() export found');
        }
      })
      .catch((err) => {
        console.error('[AnalyticsCoordinator] âŒ Failed to load runtime:', err);
      });
  }

  // DOM ready
  if (document.readyState !== 'loading') {
    initializeAnalyticsCoordinator();
  } else {
    document.addEventListener('DOMContentLoaded', initializeAnalyticsCoordinator);
  }

  // Cleanup beim Seitenwechsel
  window.addEventListener('beforeunload', () => {
    if (typeof window['analyticsCleanup'] === 'function') {
      window['analyticsCleanup']();
    }
  });

  console.log('[AnalyticsCoordinator] ðŸ“‹ Coordinator module loaded and ready');
</script>

<!-- Dummy Node, damit Astro das Script zuverlÃ¤ssig injiziert (HeaderScroll/AOS-Pattern) -->
<div style="display: none;" aria-hidden="true"></div>
