---
// evolution-hub/frontend/src/components/comments/CommentForm.astro
import Button from '../ui/Button.astro';
interface Props {
  postId: string;
}

const { postId } = Astro.props;
---

<form id="comment-form" class="mt-8">
  <h3 class="text-xl font-bold mb-4">Hinterlasse einen Kommentar</h3>
  <input type="hidden" name="postId" value={postId} />
  <div class="mb-4">
    <label for="author" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Name</label>
    <input type="text" id="author" name="author" required class="mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
  </div>
  <div class="mb-4">
    <label for="content" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Kommentar</label>
    <textarea id="content" name="content" rows="4" required class="mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea>
  </div>
  <Button type="submit">
    Kommentar absenden
  </Button>
  <p id="success-message" class="mt-4 text-green-600 hidden">Vielen Dank! Dein Kommentar wartet auf Freischaltung.</p>
</form>

<script is:inline>
  document.getElementById('comment-form')?.addEventListener('submit', async (event) => {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());

    try {
      const response = await fetch('/api/comments', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      });

      if (response.ok) {
        form.reset();
        document.getElementById('success-message')?.classList.remove('hidden');
        // Optional: dispatch event to reload comments
        document.dispatchEvent(new CustomEvent('comment_submitted'));
      } else {
        alert('Fehler beim Senden des Kommentars.');
      }
    } catch (error) {
      console.error('Error submitting comment:', error);
      alert('Ein Netzwerkfehler ist aufgetreten.');
    }
  });
</script>