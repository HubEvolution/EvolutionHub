---
import Icon from '@/components/ui/Icon.astro';
import { localizePath } from '@/lib/locale-path';
import { getLocale } from '@/lib/i18n';
import { getI18n } from '@/utils/i18n';
import Card from '@/components/ui/Card';

interface Props {
  name: string;
  description: string;
  iconKey?: string;
  color: string;
  url: string;
  isNew?: boolean;
  isPopular?: boolean;
  comingSoon?: boolean;
}

const {
  name,
  description,
  iconKey,
  color,
  url,
  isNew = false,
  isPopular = false,
  comingSoon = false,
} = Astro.props;
const locale = getLocale(Astro.url.pathname);
const t = getI18n(locale);
const srAltId = 'cs' + url.replace(/[^a-z0-9]+/gi, '-').toLowerCase() + '-desc';
const comingSoonLabel = t('comingSoon.ariaLabel') || t('comingSoon.title') || 'Coming Soon';
---

<Card
  as="article"
  variant="holo"
  className="group relative rounded-xl transition-shadow duration-300 overflow-hidden flex flex-col h-[300px] md:h-[320px] lg:h-[340px]"
  data-coming-soon={comingSoon ? 'true' : undefined}
  data-color={color}
>
  {/* Badges */}
  <div class="absolute top-4 right-4 z-20 flex space-x-2">
    {
      isNew && (
        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
          {t('pages.tools.badges.new')}
        </span>
      )
    }
    {
      isPopular && (
        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200">
          {t('pages.tools.badges.popular')}
        </span>
      )
    }
    {
      comingSoon && (
        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400">
          {t('comingSoon.title') || 'Coming Soon'}
        </span>
      )
    }
  </div>
  {/* Variant A: Only pill badge, diagonal ribbon removed */}

  <div class="p-6 flex flex-col h-full">
    <div
      class="w-12 h-12 rounded-lg flex items-center justify-center text-2xl mb-4 bg-white/10 dark:bg-white/5 ring-1 ring-white/10 text-gray-700 dark:text-gray-200"
    >
      {
        Astro.slots.has('icon') ? (
          <slot name="icon" />
        ) : iconKey ? (
          <Icon name={iconKey} class="w-6 h-6" ariaLabel={name} />
        ) : null
      }
    </div>
    <div class="flex-1 min-h-[108px] sm:min-h-[118px] md:min-h-[130px] flex flex-col">
      <h2
        class={`text-xl font-bold text-gray-900 dark:text-white mb-2 ${comingSoon ? 'blur-[3px] select-none' : ''}`}
      >
        <a
          data-tool-link
          href={localizePath(locale, url)}
          class="hover:text-emerald-600 dark:hover:text-emerald-400 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-slate-900"
          aria-label={comingSoon
            ? comingSoonLabel
            : `${t('pages.tools.card.more_about_prefix')} ${name}`}
          aria-describedby={comingSoon ? srAltId : undefined}
          aria-disabled={comingSoon ? 'true' : undefined}
          tabindex={comingSoon ? '-1' : undefined}
        >
          <span class="line-clamp-2" aria-hidden={comingSoon ? 'true' : undefined}>{name}</span>
          <span class="absolute inset-0" aria-hidden="true"></span>
        </a>
      </h2>

      <p
        class={`text-gray-600 dark:text-gray-300 text-sm leading-relaxed mb-4 line-clamp-3 ${comingSoon ? 'blur-[3px] select-none' : ''}`}
        aria-hidden={comingSoon ? 'true' : undefined}
      >
        {description}
      </p>
    </div>
    {
      comingSoon && (
        <span id={srAltId} class="sr-only">
          {comingSoonLabel}
        </span>
      )
    }

    <div
      class="mt-auto flex items-center text-sm text-emerald-600 dark:text-emerald-400 font-medium"
    >
      {t('pages.tools.card.more')}
      <svg class="ml-1 w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
        <path
          fill-rule="evenodd"
          d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z"
          clip-rule="evenodd"></path>
      </svg>
    </div>
  </div>

  {
    comingSoon && (
      <div class="absolute inset-0 rounded-xl bg-white/50 dark:bg-slate-900/50 backdrop-blur-sm pointer-events-none z-10" />
    )
  }

  {/* Hover effect */}
  <div
    class="absolute inset-0 rounded-xl transition-all duration-300 pointer-events-none ring-0 group-hover:ring-1 group-hover:ring-emerald-500/60 dark:group-hover:ring-emerald-400/60"
  >
  </div>
</Card>
